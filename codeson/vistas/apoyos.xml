<?xml version="1.0" encoding="UTF-8"?>
<odoo>
   <data>
      <record model="ir.ui.view" id="codeson.apoyo_form">
         <field name="name">Apoyo</field>
         <field name="model">codeson.apoyo</field>
         <field name="context">{'form_no_edit':[('state','=','borrador')]}</field>
         <field name="arch" type="xml">

            <form >
               <header>
                 <button name="cancelar" states="borrador,confirmado,validado,confirmado" edit='false' string="Cancelar" type="object" class="readonly"/>
                 <button name="confirmar" states="borrador" edit='false' string="Confirmar" type="object" class="btn-primary readonly"/>
                 <button name="validar" states="confirmado" edit='false' string="Validar" type="object" class="btn-primary readonly"/>
                 <button name="gen_orden_pago" states="validado" edit='false' string="Generar orden de pago" type="object" class="btn-primary readonly"/>
                 <field name="state" widget="statusbar" statusbar_visible="borrador,confirmado,validado,pagado" class="readonly" />
               </header>
               <sheet>
                 <div class="oe_button_box oe_read_only" name="button_box" >

                   <button class="oe_stat_button"  attrs="{'invisible': [('orden_id','=',0)]}" type="object" name="nada" icon="fa-money">
                       <field string="Orden de pago" name="orden_id" widget="statinfo" />
                     </button>
               <button class="oe_stat_button" type="action" name="%(codeson.documento_apoyo_action)d"
                 context="{
                        'search_default_apoyo_id': active_id,
                        'default_apoyo_id': active_id
                        }"

                   icon="fa-sticky-note">
                   <field string="Documentación" name="documentacion_count" widget="statinfo" />
               </button>
               <!--button type="object" name="action_view_invoice" class="oe_stat_button" icon="fa-pencil-square-o" attrs="{'invisible': [('state', '=', 'borrador')]}" >
                            <field name="invoice_count" widget="statinfo" string="Vendor Bills"/>
                </button-->

       </div>

                  <div class="pull-left">
                     <label for="folio" class="oe_edit_only oe_inline" />
                     <h1>
                        <field name="folio" readonly="1" />
                     </h1>
                  </div>
                  <group>
                     <group>
                       <field name="orden_id" invisible="1"/>
                        <field name="asunto"  attrs="{'readonly': [('state', '!=', 'borrador')]}"/>
                        <field name="solicita" placeholder="Solicitante"  attrs="{'readonly': [('state', '!=', 'borrador')]}" />
                        <field name="unidad_administrativa" />
                        <field name="unidad_administrativa_permitidas" invisible="1"/>
                        <field name="creador" invisible="1"/>
                     </group>
                     <group>
                        <field name="fecha"  attrs="{'readonly': [('state', '!=', 'borrador')]}"/>
                        <field name="autoriza" placeholder="Nombre de quien autoriza" domain="[('director','=',True)]"  attrs="{'readonly': [('state', '!=', 'borrador')]}"/>
                        <field name="puesto_autoriza" placeholder="Puesto de quien autoriza"  class="readonly"/>


                     </group>
                  </group>

                  <notebook>
                     <page string="Conceptos">
                        <field name="line_ids" context="{'default_unidad_administrativa':unidad_administrativa}" attrs="{'readonly': [('state', '!=', 'borrador')]}">
                           <tree>
                             <field name="unidad_administrativa"/>
                              <field name="obj_gasto" string="Partida" />
                              <field name="product_id" string="Concepto"  />
                              <field name="detalles" />
                              <field name="cantidad" />
                              <field name="unidad_medida" />
                              <field name="impuesto" string="Impuestos" widget="many2many_tags" options="{'no_create': True}" />
                              <field name="precio_unitario" />
                           </tree>
                           <form >
                             <group>
                               <group>
                                 <field name="unidad_administrativa" string="Dirección"/>
                                 <field name="product_id" string="Concepto"/>
                                 <field name="obj_gasto" string="partida"/>
                                 <field name="detalles"/>
                               </group>
                               <group>
                                 <field name="unidad_medida"/>
                                 <field name="cantidad"/>
                                 <field name="precio_unitario"/>
                                 <field name="impuesto" string="Impuestos" widget="many2many_tags" options="{'no_create': True}"/>
                               </group>
                             </group>
                           </form>
                        </field>
                     </page>
                  </notebook>
                  <group class="oe_subtotal_footer oe_right">
                                <field name="amount_untaxed" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <field name="amount_tax" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <div class="oe_subtotal_footer_separator oe_inline">
                                <label for="amount_total"/>
                                </div>
                                <field name="amount_total" nolabel="1" class="oe_subtotal_footer_separator" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                </group>
               </sheet>
            </form>
         </field>
      </record>
      <record model="ir.ui.view" id="codeson.apoyo_tree">
         <field name="name">Apoyo</field>
         <field name="model">codeson.apoyo</field>
         <field name="arch" type="xml">
            <tree>
               <field name="folio" />
               <field name="fecha"/>
               <field name="asunto" />
               <field name="solicita"/>
               <field name="documentacion"/>
               <field name="estado_facturacion"/>
               <field name="amount_total" string="Monto"/>
               <field name="state" string="Estado" />
            </tree>
         </field>
      </record>

      <record model="ir.ui.view" id="codeson.apoyo_borrador_tree">
         <field name="name">Borradores de apoyos</field>
         <field name="model">codeson.apoyo</field>
         <field name="arch" type="xml">
            <tree>
               <field name="folio" />
               <field name="asunto" />
               <field name="fecha" />
            </tree>
         </field>
      </record>

      <record model="ir.actions.act_window" id="codeson.apoyo_w">
         <field name="name">Apoyos</field>
         <field name="res_model">codeson.apoyo</field>
         <field name="view_mode">tree,form</field>
      </record>

      <record model="ir.actions.act_window" id="codeson.apoyo_borradores_w">
         <field name="name">Borradores de apoyo</field>
         <field name="res_model">codeson.apoyo</field>
         <field name="view_mode">tree,form</field>
         <field name="domain">[('state','=','borrador')]</field>
         <field name="view_id" ref="codeson.apoyo_borrador_tree" />
      </record>
      <record model="ir.actions.act_window" id="codeson.apoyo_confirmados_w">
         <field name="name">Apoyos confirmados</field>
         <field name="res_model">codeson.apoyo</field>
         <field name="view_mode">tree,form</field>
         <field name="domain">[('state','=','confirmado')]</field>
         <field name="view_id" ref="codeson.apoyo_borrador_tree" />
      </record>

      <record model="ir.actions.act_window" id="codeson.apoyo_validados_w">
         <field name="name">Apoyos validados</field>
         <field name="res_model">codeson.apoyo</field>
         <field name="view_mode">tree,form</field>
         <field name="domain">[('state','=','validado')]</field>
         <field name="view_id" ref="codeson.apoyo_borrador_tree" />
      </record>

      <record model="ir.actions.act_window" id="codeson.factura_w">
         <field name="name">Facturas</field>
         <field name="res_model">account.invoice</field>
         <field name="view_mode">tree,form</field>
      </record>


      <menuitem name="Apoyos" id="codeson.apoyo_root" sequence="2" />
      <menuitem name="Apoyos" parent="codeson.apoyo_root" id="codeson.apoyo" />
      <menuitem name="Todos" parent="codeson.apoyo" sequence="1" id="codeson.apoyo_todos" action="codeson.apoyo_w" />
      <menuitem name="Borradores" parent="codeson.apoyo" sequence="2" id="codeson.apoyo_borradores" action="codeson.apoyo_borradores_w" />
      <menuitem name="Confirmados" parent="codeson.apoyo" id="codeson.apoyo_confirmados" action="codeson.apoyo_confirmados_w" />
      <menuitem name="Validados" parent="codeson.apoyo" id="codeson.apoyo_validados" action="codeson.apoyo_validados_w" />



      <menuitem name="Evidencias" parent="codeson.apoyo_root" id="codeson.apoyo_evidencias"/>
      <menuitem name="Evidencias" parent="codeson.apoyo_evidencias" id="codeson.apoyo_evidencias2" action="codeson.evidencia_apoyo_action" />

      <menuitem name="Control" parent="codeson.apoyo_root" id="codeson.apoyo_control" />
      <menuitem name="Facturas" parent="codeson.apoyo_control" id="codeson.apoyo_cancelados" action="codeson.factura_w" />












   </data>
</odoo>
